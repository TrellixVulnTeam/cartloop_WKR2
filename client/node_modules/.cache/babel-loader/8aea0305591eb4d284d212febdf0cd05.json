{"ast":null,"code":"import _toConsumableArray from\"/Users/haleliamiad/Desktop/interviews/cartloop-chat/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/haleliamiad/Desktop/interviews/cartloop-chat/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{createContext,useState,useEffect,useRef}from'react';import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";export var ChatContext=/*#__PURE__*/createContext();export var ChatProvider=function ChatProvider(_ref){var children=_ref.children;var _useState=useState(),_useState2=_slicedToArray(_useState,2),id=_useState2[0],setId=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setMessages=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isInvalidMessage=_useState6[0],setIsInvalidMessage=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),message=_useState8[0],setMessage=_useState8[1];var socketRef=useRef();var messageData={body:message,id:id,name:'Cameron Williamson'};// Listeners\nuseEffect(function(){socketRef.current=io.connect(\"http://\".concat(window.location.hostname,\":3030\"));socketRef.current.on('id',function(userId){setId(userId);});socketRef.current.on(\"message from server\",function(message){receivedMessage(message);});socketRef.current.on('message',function(message){receivedMessage(message);});},[]);// Delete history when screen is full\nuseEffect(function(){messages.length>10?setMessages([]):null;},[messages]);// Validate against unallowed characters\nvar validateMessage=function validateMessage(){var regex=new RegExp(/[!@#$%^&*()\"{}|<>]/g);var isUnallowedChars=regex.test(message);isUnallowedChars?createToast():sendMessage();};// Emit event to server sockets\nvar sendMessage=function sendMessage(){setMessage('');socketRef.current.emit('send message',messageData);socketRef.current.emit('debounce',null);};// Notify user for invalid message\nvar createToast=function createToast(){setIsInvalidMessage(true);setTimeout(function(){setIsInvalidMessage(false);},2000);};// Check message when pressing Enter\nvar sendByKey=function sendByKey(e){e.preventDefault();validateMessage();};// Check message when pressing on 'Resolve' button\nvar sendByButton=function sendByButton(){if(!message)return;validateMessage(message);};// Set macro as message (when clicking on macro)\nvar setMacroAsMessage=function setMacroAsMessage(macro){setMessage(macro);};// Bind message and input\nvar handleChange=function handleChange(e){setMessage(e.target.value);};// Add new message to messages array\nvar receivedMessage=function receivedMessage(message){setMessages(function(oldMessages){return[].concat(_toConsumableArray(oldMessages),[message]);});};return/*#__PURE__*/_jsx(ChatContext.Provider,{value:{receivedMessage:receivedMessage,handleChange:handleChange,sendByKey:sendByKey,messages:messages,message:message,id:id,sendByButton:sendByButton,setMacroAsMessage:setMacroAsMessage,isInvalidMessage:isInvalidMessage},children:children});};","map":{"version":3,"sources":["/Users/haleliamiad/Desktop/interviews/cartloop-chat/frontend/src/context/ChatContext.js"],"names":["createContext","useState","useEffect","useRef","io","ChatContext","ChatProvider","children","id","setId","messages","setMessages","isInvalidMessage","setIsInvalidMessage","message","setMessage","socketRef","messageData","body","name","current","connect","window","location","hostname","on","userId","receivedMessage","length","validateMessage","regex","RegExp","isUnallowedChars","test","createToast","sendMessage","emit","setTimeout","sendByKey","e","preventDefault","sendByButton","setMacroAsMessage","macro","handleChange","target","value","oldMessages"],"mappings":"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","sourcesContent":["import { createContext, useState, useEffect, useRef } from 'react'\nimport io from 'socket.io-client';\nexport const ChatContext = createContext()\n\nexport const ChatProvider = ({ children }) => {\n    const [id, setId] = useState();\n    const [messages, setMessages] = useState([]);\n    const [isInvalidMessage, setIsInvalidMessage] = useState(false)\n    const [message, setMessage] = useState('');\n    const socketRef = useRef();\n    const messageData = {\n        body: message,\n        id,\n        name: 'Cameron Williamson',\n    };\n\n\n    // Listeners\n    useEffect(() => {\n        socketRef.current = io.connect(`http://${window.location.hostname}:3030`);\n        socketRef.current.on('id', (userId) => {\n            setId(userId);\n        });\n        socketRef.current.on(\"message from server\", message => {\n            receivedMessage(message);\n        })\n        socketRef.current.on('message', (message) => {\n            receivedMessage(message);\n        });\n    }, []);\n\n    // Delete history when screen is full\n    useEffect(() => {\n        messages.length > 10 ? setMessages([]) : null\n    }, [messages])\n\n    // Validate against unallowed characters\n    const validateMessage = () => {\n        const regex = new RegExp(/[!@#$%^&*()\"{}|<>]/g);\n        const isUnallowedChars = regex.test(message)\n        isUnallowedChars ? createToast() : sendMessage()\n    }\n\n    // Emit event to server sockets\n    const sendMessage = () => {\n        setMessage('');\n        socketRef.current.emit('send message', messageData);\n        socketRef.current.emit('debounce', null);\n    }\n\n    // Notify user for invalid message\n    const createToast = () => {\n        setIsInvalidMessage(true)\n        setTimeout(() => {\n            setIsInvalidMessage(false)\n        }, 2000);\n    }\n\n    // Check message when pressing Enter\n    const sendByKey = (e) => {\n        e.preventDefault();\n        validateMessage()\n    }\n\n    // Check message when pressing on 'Resolve' button\n    const sendByButton = () => {\n        if (!message) return\n        validateMessage(message)\n    }\n\n    // Set macro as message (when clicking on macro)\n    const setMacroAsMessage = (macro) => {\n        setMessage(macro)\n    }\n\n    // Bind message and input\n    const handleChange = (e) => {\n        setMessage(e.target.value);\n    }\n\n    // Add new message to messages array\n    const receivedMessage = (message) => {\n        setMessages((oldMessages) => [...oldMessages, message]);\n    }\n\n    return (\n        <ChatContext.Provider\n            value={{\n                receivedMessage, handleChange, sendByKey, messages, message, id, sendByButton, setMacroAsMessage, isInvalidMessage\n            }}>\n            {children}\n        </ChatContext.Provider>\n    )\n}"]},"metadata":{},"sourceType":"module"}